<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Dependency Ready</title>
    <script src="index.js" type="module"></script>
    <script type="module">
        // Import our module.
        import DependencyReady from './index.js';

        const fireButton = document.querySelector('.fire-depready');
        const resetButton = document.querySelector('.reset-test');
        const notReadyNode = document.getElementById('foo-not-ready');
        const readyNode = document.getElementById('foo-ready');
        const waiting = document.getElementById('foo-wait');
        
        fireButton.addEventListener('click', (event) => {
            const start = Date.now();
            const timeoutValue = document.getElementById('timeout').value;
            const setTimeoutValue = document.getElementById('settimeout').value;


            waiting.classList.add('show');

            setTimeout(() => {
                window.foo = 'I am foo!';
            }, Number(setTimeoutValue));

            const depReady = new DependencyReady('foo', Number(timeoutValue));

            depReady.waitForDependency().then(() => {
                if (depReady.hasDependency()) {

                } else {
                    waiting.classList.remove('show');
                    notReadyNode.classList.add('show');
                    resetButton.classList.add('show');
                }
            });

            /**
             * Callback function for when the window object is ready.
             */
            depReady.call(() => {
                waiting.classList.remove('show');
                readyNode.classList.add('show');
                resetButton.classList.add('show');
            });
        });

        resetButton.addEventListener('click', (event) => {
            if(typeof window?.foo !== 'undfined') {
                delete window.foo;
            }

            waiting.classList.remove('show');
            readyNode.classList.remove('show');
            notReadyNode.classList.remove('show');
            resetButton.classList.remove('show');
        });
    </script>
    <style>
        #foo-wait,
        #foo-ready,
        #foo-not-ready,
        .reset-test {
            display: none;
        }

        #foo-wait.show,
        #foo-ready.show,
        #foo-not-ready.show,
        .reset-test.show {
            display: block;
        }
    </style>
</head>
<body>
    <h1>Dependency Ready</h1>
    <label for="timeout">Enter a timeout in milliseconds to wait for the window property:</label>
    <input type="number" id="timeout" name="timeout" min="1000" max="30000" size="20" value="5000">

    <br>
    <label for="settimeout">Enter a timeout for setting the property foo on the global window object.</label>
    <input type="number" id="settimeout" name="settimeout" min="1000" max="30000" size="20" value=4000>

    <button class="fire-depready">fire</button>

    <div id="foo-wait">
        <p>Waiting for window.foo ...</p>
    </div>

    <div id="foo-ready">
        <p>Foo is ready!</p>
    </div>

    <div id="foo-not-ready">
        <p>Foo is NOT ready!</p>
    </div>
    <button class="reset-test">reset</button>
</body>
</html>